[{"text":"{\"tiddlers\": {\n\"$:/plugins/LinHQ/td-plugins/clean.icon\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/clean.icon\",\n    \"caption\": \"clean\",\n    \"collection\": \"windows\",\n    \"created\": \"20220228074403327\",\n    \"creator\": \"林汉青\",\n    \"library\": \"svg-icon\",\n    \"modified\": \"20220412161249152\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"<svg class=\\\"tc-image-clean tc-image-button\\\" width=\\\"22pt\\\" height=\\\"22pt\\\" viewBox=\\\"0 0 39.58300018310547 39.94999694824219\\\"><path d=\\\"M39.583 28.867V39.95H0V28.867h9.9c2.13 1.362 4.78 2.53 7.743 3.325 3.704.992 8.065 1.233 10.982.827v-4.152h10.958zm-2.375 2.375h-2.77v4.75h2.77v-4.75zm-10.465-.01c-2.585.36-5.75-.25-9.032-1.129-5.524-1.48-9.814-4.427-11.195-7.358l6.774-6.774 13.453 5.045v10.216zm-6.453-20.11c.345 0 .684.022 1.015.065L27.005 0l3.066 1.562-5.527 10.847c1.601 1.103 2.63 2.814 2.63 4.736 0 .825-.19 1.611-.533 2.327l-12.226-4.746c1.065-2.122 3.057-3.604 5.876-3.604z\\\"/></svg>\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/conv-button\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/conv-button\",\n    \"caption\": \"{{$:/plugins/LinHQ/td-plugins/dropbox.icon}} 转换为 External 资源\",\n    \"created\": \"20220303081200168\",\n    \"creator\": \"林汉青\",\n    \"description\": \"将此内嵌资源转换为 External 资源\",\n    \"modified\": \"20220412161249269\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"$:/tags/ViewToolbar\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"\\\\whitespace trim\\n<$list filter=\\\"[<currentTiddler>is[binary]!has[_canonical_uri]]\\\">\\n\\t<$button tooltip=\\\"删除资源\\\" class=<<tv-config-toolbar-class>>>\\n\\t\\t<$action-sendmessage $message=\\\"tm-convert-canonical\\\" $param=<<currentTiddler>> />\\n\\t\\t<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n\\t\\t\\t{{$:/plugins/LinHQ/td-plugins/dropbox.icon}}\\n\\t\\t</$list>\\n\\t\\t<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n\\t\\t\\t<span class=\\\"tc-btn-text\\\">\\n\\t\\t\\t\\t<$text text=\\\"转换当前资源\\\"/>\\n\\t\\t\\t</span>\\n\\t\\t</$list>\\n\\t</$button>\\n</$list>\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/Data\": {\n    \"text\": \"{\\n    \\\"noimg\\\": \\\"no\\\",\\n    \\\"force\\\": \\\"no\\\",\\n    \\\"autoGC\\\": \\\"yes\\\",\\n    \\\"savePath\\\": \\\"$:/LinHQ/PastedImages\\\"\\n}\",\n    \"type\": \"application/json\",\n    \"created\": \"20220223153210329\",\n    \"creator\": \"林汉青\",\n    \"modified\": \"20231023162949642\",\n    \"modifier\": \"林汉青\",\n    \"title\": \"$:/plugins/LinHQ/td-plugins/Data\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/del-button\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/del-button\",\n    \"caption\": \"{{$:/plugins/LinHQ/td-plugins/trashbin.ico}} 删除资源\",\n    \"created\": \"20220223092438077\",\n    \"creator\": \"林汉青\",\n    \"description\": \"删除 tiddler 以及链接的外部资源\",\n    \"modified\": \"20220413111254344\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"$:/tags/ViewToolbar $:/tags/EditToolbar\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"<!-- 连带外部资源删除按钮，联动 delete.js -->\\n\\\\whitespace trim\\n\\n\\\\define del-action()\\n<$action-confirm $message=\\\"真的要删除吗？\\\">\\n\\t<$action-sendmessage $message=\\\"tm-delete-canonical\\\" $param={{!!_canonical_uri}} />\\n\\t<!--注意执行顺序，当然也可用 let-->\\n\\t<$action-sendmessage $message=\\\"tm-delete-tiddler\\\" $param=<<currentTiddler>> />\\n</$action-confirm>\\n\\\\end\\n\\n<$list filter=\\\"[<currentTiddler>has[_canonical_uri]]\\\">\\n\\t<!-- 连带外部资源删除按钮，联动 delete.js -->\\n\\t<$button actions=<<del-action>> tooltip=\\\"删除资源\\\" class=<<tv-config-toolbar-class>>>\\n\\t\\t<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n\\t\\t\\t{{$:/plugins/LinHQ/td-plugins/trashbin.ico}}\\n\\t\\t</$list>\\n\\t\\t<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n\\t\\t\\t<span class=\\\"tc-btn-text\\\">\\n\\t\\t\\t\\t<$text text=\\\"删除 tiddler 以及链接的外部资源\\\"/>\\n\\t\\t\\t</span>\\n\\t\\t</$list>\\n\\t</$button>\\n</$list>\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/dropbox.icon\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/dropbox.icon\",\n    \"collection\": \"ionic\",\n    \"created\": \"20220303081411413\",\n    \"creator\": \"林汉青\",\n    \"library\": \"svg-icon\",\n    \"modified\": \"20220412161249254\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"<svg class=\\\"tc-image-social-dropbox-outline tc-image-button\\\" width=\\\"22pt\\\" height=\\\"22pt\\\" viewBox=\\\"0 0 384 357.8999938964844\\\"><path d=\\\"M113 0L0 73.9l78.3 63L192 66.1 113 0zM27.4 76.2l84.5-56.8 52.9 46-85.4 52.5-52-41.7z\\\"/><path d=\\\"M305.8 135.9L192 207l79 66.1 19-12.6v20.2l-98 59.2-98-58.5v-20.5l19 12.2 79-66.1-113.8-71.1L0 199.2l78 51.5v39.4l114 67.8 114-68.5v-39.2l78-51.2-78.2-63.1zM79.4 153.8l85.4 55.4-52.9 44.1-84.5-55.8 52-43.7zm139.8 55.4l85.4-55.4 52.1 43.6-84.5 55.8-53-44z\\\"/><path d=\\\"M384 73.9L271 0l-79 66.1 113.8 70.8 78.2-63zm-164.8-8.4l52.9-46 84.5 56.8-52 41.6-85.4-52.4z\\\"/></svg>\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/gc-button\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/gc-button\",\n    \"caption\": \"{{$:/plugins/LinHQ/td-plugins/clean.icon}} 删除未用资源\",\n    \"created\": \"20220228073716920\",\n    \"creator\": \"林汉青\",\n    \"description\": \"删除 tiddler 以及链接的外部资源\",\n    \"modified\": \"20220412161249270\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"$:/tags/PageControls\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"<!-- 删除未使用的资源，联动 gc.js -->\\n\\\\whitespace trim\\n<$button tooltip=\\\"删除未使用过的资源\\\" class=<<tv-config-toolbar-class>>>\\n\\t<$action-sendmessage $message=\\\"tm-gc-canonical\\\"/>\\n\\t<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n\\t\\t{{$:/plugins/LinHQ/td-plugins/clean.icon}}\\n\\t</$list>\\n\\t<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n\\t\\t<span class=\\\"tc-btn-text\\\">\\n\\t\\t\\t<$text text=\\\"删除未使用的资源\\\"/>\\n\\t\\t</span>\\n\\t</$list>\\n</$button>\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/History\": {\n    \"created\": \"20220224155817644\",\n    \"text\": \"!! 更新历史\\n\\n* v3.0.1：默认添加不带时间戳的文件名 `caption`。\\n* v3.0.0：默认图片保存路径可配置，彻底优化图片导入流程。\\n* v2.0.9：优化各种情况下的导入名称设定。\\n* v2.0.8：全自动导入（加时间戳），不需要手动改导入图片标题。\\n* v2.0.7：改进导入图片的默认标题。\\n* v2.0.6：改进 saver 的启用检查以避免在 //sync adaptor// 启用的情况下激活 saver。\\n* v2.0.5：劫持 alert，调整代码风格。\\n* v2.0.4：更准确的保存成功与否检测。\\n* v2.0.3：修复 saver `cansave` 判断总是为真的问题。\\n* v2.0.2：修复因为改名导致的配置不生效问题。\\n* v2.0.1：简化写法，劫持 comfirm。\\n* v2.0.0：为 TD 定制 saver 模块。\\n* v1.1.0：支持一键转换内嵌资源为外部资源。\\n* v1.0.2：改进写法。\\n* v1.0.1：修复少量 bug。\\n* v1.0.0：正式完成\\n** 使用 startup.js 合并所有的与 Td 交互的逻辑。\\n** 调整 startup.js 的加载时机避免依赖的方法为空。\\n** 允许在启动时自动清理附件。\\n* v0.0.7：增强，允许一键删除不再使用的外部资源，使用时间戳避免文件名重复。\\n* v0.0.6：增强，直接传输数据回 Main ，即使 path 为空也能成功创建文件。\\n* v0.0.5：添加类型白名单避免无法导入 json 文件，添加强制导入选项。\",\n    \"title\": \"$:/plugins/LinHQ/td-plugins/History\",\n    \"creator\": \"林汉青\",\n    \"modified\": \"20231024014810781\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/icon\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/icon\",\n    \"caption\": \"database-download-fill-fill\",\n    \"category\": \"Datas\",\n    \"collection\": \"Fill\",\n    \"created\": \"20220228074655299\",\n    \"creator\": \"林汉青\",\n    \"library\": \"IconPark\",\n    \"library_version\": \"1.3.0\",\n    \"modified\": \"20220412161249303\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"<svg width=\\\"22pt\\\" height=\\\"22pt\\\" class=\\\"tc-image-ipk-database-download-fill tc-image-button\\\" viewBox=\\\"0 0 48 48\\\" fill=\\\"none\\\"><rect width=\\\"48\\\" height=\\\"48\\\" fill=\\\"white\\\" fill-opacity=\\\"0.01\\\"/><path d=\\\"M44 31C44 36.5228 39.5228 41 34 41C32.2091 41 30.5281 40.5292 29.0741 39.7046C26.5143 38.2529 24.6579 35.7046 24.1436 32.6983C24.0492 32.1463 24 31.5789 24 31C24 28.4323 24.9678 26.0906 26.5585 24.3198C28.3892 22.2818 31.0449 21 34 21C39.5228 21 44 25.4772 44 31Z\\\" fill=\\\"black\\\" stroke=\\\"black\\\" stroke-width=\\\"4\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/><path d=\\\"M34 12V20V21C31.0449 21 28.3892 22.2818 26.5585 24.3198C24.9678 26.0906 24 28.4323 24 31C24 31.5789 24.0492 32.1463 24.1436 32.6983C24.6579 35.7046 26.5143 38.2529 29.0741 39.7046C26.4116 40.5096 22.8776 41 19 41C10.7157 41 4 38.7614 4 36V28V20V12\\\" stroke=\\\"black\\\" stroke-width=\\\"4\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/><path d=\\\"M34 12C34 14.7614 27.2843 17 19 17C10.7157 17 4 14.7614 4 12C4 9.23858 10.7157 7 19 7C27.2843 7 34 9.23858 34 12Z\\\" fill=\\\"black\\\" stroke=\\\"black\\\" stroke-width=\\\"4\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/><path d=\\\"M4 28C4 30.7614 10.7157 33 19 33C20.807 33 22.5393 32.8935 24.1436 32.6983\\\" stroke=\\\"black\\\" stroke-width=\\\"4\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/><path d=\\\"M4 20C4 22.7614 10.7157 25 19 25C21.7563 25 24.339 24.7522 26.5585 24.3198\\\" stroke=\\\"black\\\" stroke-width=\\\"4\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/><path d=\\\"M34 26V36M34 36L38 32M34 36L30 32\\\" stroke=\\\"white\\\" stroke-width=\\\"4\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/></svg>\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/plugin.info\": {\n    \"created\": \"20220223045851211\",\n    \"text\": \"{\\n    \\\"title\\\": \\\"$:/plugins/LinHQ/td-plugins\\\",\\n    \\\"name\\\": \\\"TDPlugins\\\",\\n    \\\"description\\\": \\\"适配 td 一些高级操作\\\",\\n    \\\"author\\\": \\\"LinHQ1999\\\",\\n    \\\"version\\\": \\\"3.0.1\\\",\\n    \\\"core-version\\\": \\\">=5.2.1\\\",\\n    \\\"source\\\": \\\"\\\",\\n    \\\"list\\\": \\\"Readme Settings History\\\",\\n    \\\"parent-plugin\\\": \\\"\\\",\\n    \\\"dependents\\\": \\\"$:/plugins/Gk0Wk/focused-tiddler\\\",\\n    \\\"plugin-type\\\": \\\"plugin\\\",\\n    \\\"packaged-by\\\": \\\"Gatha on 24th 十月 2023, 09:48:22\\\"\\n}\",\n    \"type\": \"application/json\",\n    \"creator\": \"林汉青\",\n    \"modified\": \"20231024014822044\",\n    \"modifier\": \"林汉青\",\n    \"title\": \"$:/plugins/LinHQ/td-plugins/plugin.info\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/Readme\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/Readme\",\n    \"created\": \"20220223153527297\",\n    \"creator\": \"林汉青\",\n    \"modified\": \"20220412161249332\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"! Td 桌面程序增强插件\\n\\n!! 功能\\n\\n# 拖入的附件直接存储为 external 形式，并存放在默认静态服务器目录 `files` 下。\\n# 添加按钮可以直接在删除 external 资源的时候也删除掉文件。\\n# 可以在启动时自动回收掉多余的外部资源。\\n# 支持一键转换内嵌资源为外部资源。\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/saver.js\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/saver.js\",\n    \"text\": \"/*\\\\\\ntitle: $:/plugins/LinHQ/td-plugins/saver.js\\ntype: application/javascript\\nmodule-type: saver\\n\\nModified from $:/core/modules/savers/nodewebkit.js\\n\\n\\\\*/\\n(function(){\\n\\n\\t/*jslint node: true, browser: true */\\n\\t/*global $tw: false, netscape: false, Components: false */\\n\\t\\\"use strict\\\";\\n\\n\\tconst TDSaver = function(wiki) { };\\n\\n\\tTDSaver.prototype.save = function(text,method,callback) {\\n\\t\\t// 根据开启的情况自动决定，比如此处不包括 download\\n\\t\\tif (!this.info.capabilities.includes(method)) return false;\\n\\t\\t// Get the pathname of this document\\n\\t\\tlet pathname = document.location.pathname;\\n\\t\\t// Test for a Windows path of the form /x:/blah/blah\\n\\t\\tif(/^\\\\/[A-Z]\\\\:\\\\//i.test(pathname)) {\\n\\t\\t\\t// Remove the leading slash\\n\\t\\t\\tpathname = pathname.substr(1);\\n\\t\\t\\t// Convert slashes to backslashes\\n\\t\\t\\tpathname = pathname.replace(/\\\\//g,\\\"\\\\\\\\\\\");\\n\\t\\t}\\n\\n\\t\\twindow.TD.save($tw.utils.decodeURIComponentSafe(pathname), text)\\n\\t\\t\\t.then(() => callback(null))\\n\\t\\t\\t.catch(() => callback(\\\"Save failed\\\"))\\n\\t\\t\\n\\t\\treturn true\\n\\t};\\n\\n\\t/*\\n\\tInformation about this saver\\n\\t*/\\n\\tTDSaver.prototype.info = {\\n\\t\\tname: \\\"td\\\",\\n\\t\\tpriority: 3000,\\n\\t\\tcapabilities: [\\\"save\\\", \\\"autosave\\\"]\\n\\t};\\n\\n\\t/*\\n\\tStatic method that returns true if this saver is capable of working\\n\\t*/\\n\\texports.canSave = function(wiki) {\\n\\t\\t// Check if we're running under TD\\n\\t\\treturn typeof window.TD === \\\"object\\\" && !$tw.syncadaptor;\\n\\t};\\n\\n\\t/*\\n\\tCreate an instance of this saver\\n\\t*/\\n\\texports.create = function(wiki) {\\n\\t\\treturn new TDSaver(wiki);\\n\\t};\\n\\n})();\",\n    \"type\": \"application/javascript\",\n    \"module-type\": \"saver\",\n    \"created\": \"20220412161310943\",\n    \"creator\": \"林汉青\",\n    \"modified\": \"20220623063744227\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/Settings\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/Settings\",\n    \"caption\": \"TDPlugins\",\n    \"created\": \"20220223142704222\",\n    \"creator\": \"林汉青\",\n    \"modified\": \"20231023163239685\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"$:/tags/ControlPanel/SettingsTab\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"@@display: flex;flex-direction: column;\\n<h2>文件导入</h2>\\n\\n* <$checkbox\\n\\ttiddler=\\\"$:/plugins/LinHQ/td-plugins/Data\\\"\\n\\tindex=\\\"noimg\\\"\\n\\tunchecked=\\\"no\\\"\\n\\tchecked=\\\"yes\\\"\\n\\t> 不要处理图片</$checkbox>\\n* <$checkbox\\n\\ttiddler=\\\"$:/plugins/LinHQ/td-plugins/Data\\\"\\n\\tindex=\\\"force\\\"\\n\\tunchecked=\\\"no\\\"\\n\\tchecked=\\\"yes\\\"\\n\\t> 即使不运行于 TD 或者路径为空，也导入为 canonical 形式</$checkbox>\\n* 默认保存路径（不带最后的斜杠）：<$edit-text type=\\\"text\\\" tag=\\\"input\\\" tiddler=\\\"$:/plugins/LinHQ/td-plugins/Data\\\"\\n\\tindex=\\\"savePath\\\"\\n\\tdefault=\\\"$:/LinHQ/PastedImages\\\"/>\\n\\t\\n<h2>自动操作</h2>\\n\\n* <$checkbox\\n\\ttiddler=\\\"$:/plugins/LinHQ/td-plugins/Data\\\"\\n\\tindex=\\\"autoGC\\\"\\n\\tunchecked=\\\"no\\\"\\n\\tchecked=\\\"yes\\\"\\n\\t> 启动时自动清理附件</$checkbox>\\n@@\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/startup.js\": {\n    \"created\": \"20220228114328020\",\n    \"text\": \"/*\\\\\\ntitle: $:/plugins/LinHQ/td-plugins/startup.js\\ntype: application/javascript\\nmodule-type: startup\\n\\n和 Td 程序进行的所有交互\\n\\n\\\\*/\\n(function () {\\n  \\\"use strict\\\";\\n\\n  exports.name = \\\"TDCaller\\\";\\n  exports.platforms = [\\\"browser\\\"];\\n  // 依赖 $tw.rootWidget\\n  exports.after = [\\\"startup\\\"];\\n  exports.synchronous = true;\\n\\n  const SETTINGS = \\\"$:/plugins/LinHQ/td-plugins/Data\\\"\\n\\n  /**\\n  * 让 Td 移走没有用到的附件\\n  */\\n  function GC() {\\n    const filter = \\\"[has[_canonical_uri]] :map[get[_canonical_uri]]\\\"\\n    const fnames = $tw.wiki.filterTiddlers(filter)\\n    window.TD.gc(fnames)\\n  }\\n\\n  function ext(path) {\\n    if (!path.includes('.')) return path\\n    return path.slice(path.lastIndexOf('.'))\\n  }\\n\\n  exports.startup = function () {\\n    if (!window.TD || !$tw.rootWidget || !$tw.wiki) {\\n      console.warn(\\\"加载时机不对……\\\")\\n      return\\n    }\\n\\n    // 劫持默认的 confirm 避免输入框无法聚焦\\n    window.confirm = window.TD.confirm\\n    window.alert = window.TD.alert\\n\\n    // 处理自动附件清理\\n    let settings = $tw.wiki.getTiddlerData(SETTINGS)\\n    let autogc = settings?.autoGC ?? \\\"no\\\"\\n    if (autogc === \\\"yes\\\") GC()\\n\\n    // 手动触发的 GC 事件\\n    $tw.rootWidget.addEventListener(\\\"tm-gc-canonical\\\", _ => {\\n      GC()\\n    })\\n\\n    // 处理文件导入\\n    $tw.hooks.addHook(\\\"th-importing-file\\\", function (info) {\\n      /**\\n        * 逻辑解释\\n        *\\n        * 如果导入时聚焦的 Tiddler 是处于编辑状态（对应在编辑器中直接粘贴导入），那么格式是 时间戳.标题名.拓展名\\n        * 其他状态下，格式是 时间戳.获取到的图片名（包括拓展名）\\n        */\\n      const currentEditing = $tw.wiki.getTiddler($tw.wiki.getTiddlerText('$:/temp/focussedTiddler'))\\n      let fileName = ''\\n      if (currentEditing && Object.hasOwn(currentEditing.fields, 'draft.title')) {\\n        fileName = `${new Date().getTime()}.${currentEditing.fields['draft.title']}${ext(info.file.name)}`\\n      } else {\\n        fileName = `${new Date().getTime()}.${info.file.name}`\\n      }\\n\\n      // text/json, application/json...\\n      let WHITELIST = [\\\"text\\\", \\\"javascript\\\", \\\"json\\\"]\\n\\n      // 不要放外面，每次都重新获取值\\n      let settings = $tw.wiki.getTiddlerData(SETTINGS)\\n      // 默认所有图片都是外部的\\n      let noimg = settings?.noimg ?? \\\"no\\\"\\n      // 默认不强制导入\\n      let force = settings?.force ?? \\\"no\\\"\\n      // 指示是否已拷贝资源\\n      let processed = false\\n\\n      // 白名单检查\\n      if (WHITELIST.some(type => info.type.includes(type))) return false\\n\\n      // 是否处理图片\\n      if (noimg == \\\"yes\\\" && info.type.includes(\\\"image\\\")) {\\n        return false\\n      }\\n\\n      // 本地拖拽一般都有路径，直接拷贝\\n      if (info.file.path) {\\n        window.TD.import({ name: fileName, path: info.file.path })\\n        processed = true\\n      } else {\\n        // 从网络或者剪贴板就没有路径信息\\n        // 实验性功能，大文件可能严重影响性能——ipcRenderer 只能传输 Blob 支持中的 ArrayBuffer 类型\\n        // 限于核心功能，如果后面创建 Tiddler 的内容需要此处的数据，强行实现则会出现导入两次的 bug。\\n        info.file.arrayBuffer()\\n          .then(buffer => window.TD.download(buffer, fileName))\\n          .catch(console.error)\\n        processed = true\\n      }\\n\\n      // 要么是正常流程成功拷贝，要么是强制导入，否则使用默认行为\\n      if (processed || force === \\\"yes\\\") {\\n        info.callback([\\n          {\\n            title: `${settings.savePath ?? '$:/LinHQ/PastedImages'}/${fileName}`,\\n            type: info.type,\\n            \\\"_canonical_uri\\\": `./files/${fileName}`,\\n\\t\\t\\t\\t\\t\\tcaption: fileName.slice(fileName.indexOf('.') + 1)\\n          }\\n        ]);\\n        return true\\n      }\\n      return false\\n    })\\n\\n    /**\\n    * 内嵌转外部 $param=title\\n    */\\n    $tw.rootWidget.addEventListener(\\\"tm-convert-canonical\\\", info => {\\n      const current = $tw.wiki.getTiddler(info.param)\\n      let STAMP = new Date().getTime()\\n      if (current) {\\n        let { title, text, ...oth } = current.fields\\n        let ex_title = `${STAMP}.${title}`\\n        window.TD.convert(text, ex_title)\\n        $tw.wiki.setText(title, \\\"text\\\", null, null)\\n        $tw.wiki.setText(title, \\\"_canonical_uri\\\", null, `./files/${ex_title}`)\\n        return true\\n      }\\n      return false\\n    })\\n\\n    /**\\n    * 处理连带删除操作，$param=_canonical_uri\\n    */\\n    $tw.rootWidget.addEventListener(\\\"tm-delete-canonical\\\", event => {\\n      let conc = event.param\\n      if (conc) {\\n        window.TD.delete(conc)\\n        return true\\n      }\\n      return false\\n    })\\n  }\\n})()\\n\",\n    \"title\": \"$:/plugins/LinHQ/td-plugins/startup.js\",\n    \"type\": \"application/javascript\",\n    \"module-type\": \"startup\",\n    \"creator\": \"林汉青\",\n    \"modified\": \"20231024014719565\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n},\n\n\"$:/plugins/LinHQ/td-plugins/trashbin.ico\": {\n    \"title\": \"$:/plugins/LinHQ/td-plugins/trashbin.ico\",\n    \"caption\": \"trash_can\",\n    \"collection\": \"mfglabs\",\n    \"created\": \"20220223094135117\",\n    \"creator\": \"林汉青\",\n    \"library\": \"svg-icon\",\n    \"modified\": \"20220412161249376\",\n    \"modifier\": \"林汉青\",\n    \"tags\": \"\",\n    \"type\": \"text/vnd.tiddlywiki\",\n    \"text\": \"<svg class=\\\"tc-image-trash_can tc-image-button\\\" width=\\\"22pt\\\" height=\\\"22pt\\\" viewBox=\\\"0 0 1813 1920\\\"><path d=\\\"M0 275q0-75 121-138T451 37 906 0q247 0 456 37t330 100 121 138q-21 165-79 466t-113.5 565-58.5 283q-13 74-81.5 138t-165 105-204.5 64.5-205 23.5-205-23.5-204-64.5-164.5-105-81.5-138q-8-43-67-328.5t-114-570T0 275zm259 458l77 375 178-154zm11-397q0 65 186 110.5T906 492q265 0 451-45.5T1543 336q0-66-186.5-112T906 178t-450 46-186 112zm113 1000l43 210 101-87zm16-638l207 178 146-127q-194-12-353-51zm11 504l207 179 197-169-208-179zm101 428q146 62 304 77l-198-169zm185-676l208 179 197-169-204-183zm13 505l209 181 194-171-208-179zm286-247l207 178 189-164-201-182zm29 493q145-17 275-73l-96-84zm17-955l150 136 217-187q-162 41-367 51zm239 216l191 172 84-408zm14 503l92 80 40-196z\\\"/></svg>\",\n    \"revision\": \"0\",\n    \"bag\": \"default\"\n}}\n}","type":"application/json","author":"LinHQ1999","core-version":">=5.2.1","created":"20220223045515362","creator":"林汉青","dependents":"$:/plugins/Gk0Wk/focused-tiddler","description":"适配 td 一些高级操作","list":"Readme Settings History","modified":"20231024014820983","modifier":"林汉青","name":"TDPlugins","packaged-by":"Gatha on 24th 十月 2023, 09:48:28","plugin-type":"plugin","tags":"","title":"$:/plugins/LinHQ/td-plugins","version":"3.0.1","revision":"0","bag":"default"}]